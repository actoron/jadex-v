// Skip old/unfinished projects in gradle build. these are still included in eclipse
def excludes = ['communication', 'nfproperties']

['clean', 'compileJava', 'build', 'test', 'wrapper', 'sonarcube'].each { mytask ->
	if(tasks.names.contains(mytask)) {
		//println "Configuring task '"+mytask+"'"
		tasks.named(mytask) {
			gradle.includedBuilds.each { build ->
				if(!excludes.contains(build.name)) {
					dependsOn build.task(':'+mytask)
				}
			}
		}
	}
	else {
		//println "Creating task '"+mytask+"'"
		project.tasks.create([name: mytask]) {	
			gradle.includedBuilds.each { build ->
				if(!excludes.contains(build.name)) {
					dependsOn build.task(':'+mytask)
				}
			}
		}
	}
}


/*def hasSources(build) {
    return file("${build.projectDir}/src").exists()
}

gradle.includedBuilds.each { build ->
    if (hasSources(build)) {
        tasks.register("copyDeps_${build.name}", Copy) {
        	println "register $build.name"
            doLast {
                println "in copy"
                copy {
                    from configurations.implementation
                    into 'build/deps'
                }
            }
        }
        ['build'].each { taskName ->
            tasks.named(taskName) { dependsOn "copyDeps_${build.name}" }
        }
    }
}*/